class e{static _prepareRoutesTree(e,t){let i=function(e){let n={};return e.forEach(e=>{let o=e.name.replace(/(\s+|-)/g,"").toLowerCase();if(!n[o]){let i=e.path;switch(t){case"browser":case"query":i=e.path;break;case"hash":i="/#"+e.path}n[o]={path:i}}if("object"==typeof e.children&&Array.isArray(e.children.items))n[o].children={type:"known",items:i(e.children.items)};else if("string"==typeof e.children&&0===e.children.indexOf("@event:")){let t=e.children.substring("@event:".length);n[o].children={type:"event",event:t}}}),n};return i(e)}static _prepareConfiguration(t,i){let n={};n.baseUrl=i;let o=i+"pages/",s=new URL(i).pathname;if(t.modals&&(n.modals={},Object.keys(t.modals).length))for(let e in t.modals)n.modals[e]=o+t.modals[e];if(!t.menu||!t.menu.defaultMenuConfig)throw new Error("Default menu configuration is missing");let r=t.menu.defaultMenuConfig;t.profile&&(n.profile=t.profile);let a=function(e){for(let t=0;t<e.length;t++)e[t].children&&e[t].children.items?a(e[t].children.items):void 0!==e[t].indexed&&"false"===e[t].indexed.toString()&&(e.splice(t,1),t--);return e},l=function(e,t){return t=t?t.replace(/^\/|\/$/g,""):"",e.forEach(e=>{if(!e.path){let t=e.name.toLowerCase().toLowerCase().replace(/\s+/g,"-");t=t.replace(/[:\/]/g,""),e.path=t}let i="/";0===t.length&&(i=""),e.path.startsWith("/")||(e.path=i+e.path);let n=t+e.path;if(n=n.replace(/^\//g,""),e.path=n,e.children)e.type="abstract",e.icon||(e.icon=r.icon);else{for(let t in r)e.hasOwnProperty(t)||(e[t]=r[t]);if("psk-page-loader"===e.component)if(e.componentProps||(e.componentProps={}),Object.assign(e.componentProps,e.options),e.pageSrc)e.componentProps.pageUrl=e.pageSrc.startsWith("http")?e.pageSrc:o+e.pageSrc;else{let n=e.name.replace(/[:.!?]/g,"").replace(/\s/g,"-").toLowerCase();e.componentProps.pageUrl=o+t+i+n+".html"}}if("object"==typeof e.children&&Array.isArray(e.children))e.children={type:"known",items:JSON.parse(JSON.stringify(e.children))},l(e.children.items,n);else if("string"==typeof e.children&&0==e.children.indexOf("@event:")){let t=e.children.substring("@event:".length);e.children={type:"event",event:t}}}),e};n.routes=l(t.menu.pages),n.historyType="browser";let f=t.menu.defaultMenuConfig.historyType;"hash"!==f&&"query"!==f||(n.historyType=f);let p=s;if("query"===f){let e="?";t.menu.defaultMenuConfig.pagePrefix&&(e=t.menu.defaultMenuConfig.pagePrefix),p=s+e}(e=>{let t=function(i){i.forEach(i=>{let n=i.path;0===n.indexOf("/")&&(n=n.substr(1)),i.path=`${e}${n}`,i.children&&i.children.items&&t(i.children.items)})};t(n.routes)})(p);let c=JSON.parse(JSON.stringify(n.routes)),u=JSON.parse(JSON.stringify(c));return n.menu=a(u),n.tags=function(e){let t=[];return function e(i){i.forEach(i=>{Object.prototype.hasOwnProperty.call(i,"tags")&&i.tags.split(",").map(e=>e.trim()).forEach(e=>{t[e]=i.path}),"object"==typeof i.children&&Array.isArray(i.children.items)&&e(i.children.items)})}(e),t}(c),n.pagesHierarchy=e._prepareRoutesTree(n.routes,f),n}}const t={theme:"default",appVersion:"1.0.0",profile:{username:"Cardinal App",email:"privatesky@axiologic.net",avatar:"https://privatesky.xyz/assets/images/privatesky.png"},menu:{defaultMenuConfig:{icon:"fa-bars",type:"route",component:"psk-page-loader",exact:!1,indexed:!0,historyType:"browser"},pages:[{name:"Home",path:"/home",pageSrc:"index.html"}]}};let i="config.json",n="menu.json";window.globalConfig={};class o{constructor(t){let o;this.configIsLoaded=!1,this.pendingRequests=[],window&&window.location&&window.location.origin&&(o=window.location.origin);let s=document.querySelector("base");if(s){let e=s.getAttribute("href");e&&(o+=e)}o.endsWith("/")||(o+="/"),i=o+i,n=o+n,window.basePath=o,this._getAppConfiguration(i,(t,i)=>{if(t)return console.log(t);this._fetchConfigurationFile(n,(t,n)=>{for(t?console.log(t):i.menu=n,this.configuration=e._prepareConfiguration(i,o),this.configuration.theme=i.theme,this.configuration.appVersion=i.appVersion,this.configIsLoaded=!0;this.pendingRequests.length;){let e=this.pendingRequests.pop();this.respondWithConfiguration(e.configName,e.callback)}})}),t.addEventListener("getThemeConfig",this._provideConfig("theme")),t.addEventListener("getAppVersion",this._provideConfig("appVersion")),t.addEventListener("needRoutes",this._provideConfig("routes")),t.addEventListener("needMenuItems",this._provideConfig("menu")),t.addEventListener("getUserInfo",this._provideConfig("profile")),t.addEventListener("getHistoryType",this._provideConfig("historyType")),t.addEventListener("getModals",this._provideConfig("modals")),t.addEventListener("getTags",this._provideConfig("tags")),t.addEventListener("getConfiguration",this._provideConfig()),t.addEventListener("validateUrl",e=>{e.stopImmediatePropagation();let{sourceUrl:t,callback:i}=e.detail;i&&"function"==typeof i?this._parseSourceUrl(t,i):console.error("Callback was not properly provided!")}),t.addEventListener("getCustomLandingPage",e=>{let t=e.detail;if(window.frameElement&&window.frameElement.hasAttribute("landing-page"))return t(void 0,window.frameElement.getAttribute("landing-page"));t()})}_provideConfig(e){return t=>{t.stopImmediatePropagation();let i=t.detail;if(i&&"function"==typeof i){if(this.configIsLoaded)return this.respondWithConfiguration(e,i);this.pendingRequests.push({configName:e,callback:i})}}}respondWithConfiguration(e,t){if(void 0!==e&&!this.configuration[e])throw new Error(`Config ${e} does not exists`);if(void 0===e)return t(void 0,this.configuration);t(void 0,this.configuration[e])}_parseSourceUrl(e,t){let i=(e=e.replace(/(\s+|-)/g,"").toLowerCase()).split("/"),n=this.configuration.pagesHierarchy;for(let o=0;o<i.length;o++){let s=i[o];const r=Object.keys(n).find((function(e){return-1!==n[e].path.toLowerCase().indexOf(s)}));let a,l,f=void 0!==n[r];if(!n[s]&&!f){t(e+" is not a valid path in the application!");break}if(a=f?n[r].children:n[s].children,"object"!=typeof a||"object"!=typeof a.items||o===i.length)return l=f?n[r].path:n[s].path,t(void 0,l);n=a.items}}_getAppConfiguration(e,i){this._fetchConfigurationFile(e,(e,n)=>{if(e)return console.log(e),i(void 0,t);for(let e in t)n.hasOwnProperty(e)||(n[e]=t[e]);i(void 0,n)})}_fetchConfigurationFile(e,t){fetch(e).then((function(e){return e.json()})).then((function(e){t(void 0,e)})).catch((function(e){t(e)}))}}export{e as A,o as D,t as d}